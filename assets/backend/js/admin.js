var flmbkp_back_fm=flmbkp_back_fm||null,flmbkp_back_backup=(($uifm="undefined"==typeof $uifm?jQuery:$uifm).isFunction(flmbkp_back_fm)||!function(e,s){"use strict";var t=function(){this.initialize=function(){e(document).on("change",".uiform-editing-header select",function(e){t.header_options_submit()})},this.header_options_submit=function(){console.log("change  submit"),e.ajax({type:"POST",url:ajaxurl,data:{action:"flmbkp_header_options",page:"flmbkp_file_manager",flmbkp_security:flmbkp_vars.ajax_nonce,options:e("#flmbkp_header_opt").serialize()},success:function(e){flmbkp_back_helper.redirect_tourl(e.url)}})}};s.flmbkp_back_fm=t=e.flmbkp_back_fm=new t,t.initialize()}($uifm,window),flmbkp_back_backup||null),flmbkp_back_settings=(($uifm="undefined"==typeof $uifm?jQuery:$uifm).isFunction(flmbkp_back_backup)||!function(t,p){"use strict";var r=function(){function e(){p.progressLogObj=p.progressLogObj||t("#flmbkp_processLog"),p.progressBarObj=p.progressBarObj||{},p.progressBarMsgObj=p.progressBarMsgObj||{}}function s(){t("#flmbkp_cancel_btn").hide().prop("disabled",!0),t("#flmbkp_backup_btn").prop("disabled",!1)}p.flmbkp_slug=p.flmbkp_slug||"",p.flmbkp_counter_qu=p.flmbkp_counter_qu||{},p.url_redirect_afterbkp=p.url_redirect_afterbkp||"",p.processFinished=!0,p.progressLastRun=!1,p.lastPrintedMessage="",p.initialRun=1,p.selected_paths=[],p.lastZipResponse={},p.isPaused=!1,p.cwd="",p.dir_listing=[],p.currentOption="",p.tmp_var1=null,p.flmbkp_is_cancelling=!1;this.initialize=function(){e(),t(document).on("click","#flmbkp_backup_btn",function(e){return e.preventDefault(),e.stopPropagation(),t(this).prop("disabled",!0),r.options_createRec(),!1}),t(document).on("click","#flmbkp_cancel_btn",function(e){return e.preventDefault(),e.stopPropagation(),p.flmbkp_is_cancelling||(p.flmbkp_is_cancelling=!0,t(this).prop("disabled",!0),r.request_cancel_and_cleanup()),!1})},this.request_cancel_and_cleanup=function(){p.isPaused=!0,p.processFinished=!0,t.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"flmbkp_backup_cancel",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,flmbkp_slug:p.flmbkp_slug,current_step:p.currentOption||""}}).always(function(){t.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"flmbkp_backup_cleanup",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,flmbkp_slug:p.flmbkp_slug}}).always(function(){p.flmbkp_is_cancelling=!1,p.currentOption="",p.flmbkp_counter_qu={},t("#flmbkp_progress_plugins,#flmbkp_progress_themes,#flmbkp_progress_uploads,#flmbkp_progress_others,#flmbkp_progress_database").hide(),t("#flmbkp_plugins_progress_msg, #flmbkp_themes_progress_msg, #flmbkp_uploads_progress_msg, #flmbkp_others_progress_msg, #flmbkp_database_progress_msg").text("0%").css("width","0%"),t("#flmbkp_plugins_progress, #flmbkp_themes_progress, #flmbkp_uploads_progress, #flmbkp_others_progress, #flmbkp_database_progress").attr("aria-valuenow",0).css("width","0%").removeClass("active"),t("#flmbkp_progress_graph").hide(),p.progressLogObj&&progressLogObj.val(""),s()})})},this.options_createRec=function(){0<t("#flmbkp_backup_form input:checked").length?(t("#flmbkp_backup_btn").prop("disabled",!0),t("#flmbkp_cancel_btn").show().prop("disabled",!1),t("#flmbkp_progress_graph").show(),e(),t.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"flmbkp_backup_createrec",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,options:t("#flmbkp_backup_form").serialize()},success:function(e){for(var s in p.flmbkp_slug=e.slug,p.flmbkp_counter_qu=e.pending,p.url_redirect_afterbkp=e.url_redirect,p.flmbkp_counter_qu)p.flmbkp_counter_qu.hasOwnProperty(s)&&t("#flmbkp_progress_"+p.flmbkp_counter_qu[s]).show();r.options_routeNextStep()},error:function(){s()}})):(t("#flmbkp_backup_btn").prop("disabled",!1),alert("Select one option at least"))},this.records_delreg=function(e){t.ajax({type:"POST",url:ajaxurl,data:{action:"flmbkp_backup_delete_records",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,rec_id:e},success:function(){t(".sfdc-block1-container a[data-recid='"+e+"']").closest("tr").fadeOut("slow")}})},this.records_restore=function(e){t.ajax({type:"POST",url:ajaxurl,data:{action:"flmbkp_backup_restore_records",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,rec_id:e},success:function(e){t("#flmbkp_Modal").modal({show:!0,backdrop:"static",keyboard:!1}),t("#flmbkp_Modal .modal-title").html(e.modal_title),t("#flmbkp_Modal .modal-body").html(e.modal_body)}})},this.options_routeNextStep=function(){if(t.isEmptyObject(p.flmbkp_counter_qu))p.nextstep="",p.processFinished=!0,s(),flmbkp_back_helper.redirect_tourl(p.url_redirect_afterbkp);else switch(e(),p.processFinished=!0,p.progressLastRun=!1,p.lastPrintedMessage="",p.initialRun=1,p.selected_paths=[],p.lastZipResponse={},p.isPaused=!1,p.cwd="",p.dir_listing=[],p.tmp_var1=function(e){for(var s in e)if(e.hasOwnProperty(s))return[e[s],s];return["",null]}(p.flmbkp_counter_qu),p.currentOption=p.tmp_var1[0],null!==p.tmp_var1[1]&&delete p.flmbkp_counter_qu[p.tmp_var1[1]],String(p.currentOption)){case"plugins":progressBarObj[currentOption]=t("#flmbkp_plugins_progress"),progressBarMsgObj[currentOption]=t("#flmbkp_plugins_progress_msg"),r.options_filebackup();break;case"themes":progressBarObj[currentOption]=t("#flmbkp_themes_progress"),progressBarMsgObj[currentOption]=t("#flmbkp_themes_progress_msg"),r.options_filebackup();break;case"uploads":progressBarObj[currentOption]=t("#flmbkp_uploads_progress"),progressBarMsgObj[currentOption]=t("#flmbkp_uploads_progress_msg"),r.options_filebackup();break;case"others":progressBarObj[currentOption]=t("#flmbkp_others_progress"),progressBarMsgObj[currentOption]=t("#flmbkp_others_progress_msg"),r.options_filebackup();break;case"database":progressBarObj[currentOption]=t("#flmbkp_database_progress"),progressBarMsgObj[currentOption]=t("#flmbkp_database_progress_msg"),r.options_filebackup();break;default:console.log("there is no option"),r.options_routeNextStep()}},this.options_downloadFiles=function(e){t("body").append("<iframe src='"+ajaxurl+"?action=flmbkp_backup_downloadfile&page=flmbkp_page_backups&flmbkp_security="+flmbkp_vars.ajax_nonce+"&flm_file="+encodeURIComponent(e)+"' style='display: none;' ></iframe>")},this.options_filebackup=function(){p.flmbkp_is_cancelling||(p.isPaused=!1,p.selected_paths=[p.cwd],p.isPaused)||(p.initialRun&&(progressLogObj.val(""),p.lastPrintedMessage=""),progressBarObj[currentOption].addClass("active"),t.ajax({type:"POST",url:ajaxurl,dataType:"json",beforeSend:function(){p.processFinished=!1,p.initialRun&&r.watchProgress(),p.initialRun=0},data:{targets:p.selected_paths,flush_to_disk:50,max_execution_time:20,excludes:"",is_initial_run:p.initialRun,use_system_calls:!1,nexstep:p.currentOption,flmbkp_slug:p.flmbkp_slug,action:"flmbkp_backup_sendoptions",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce},success:function(e){p.lastZipResponse=e},complete:function(){p.flmbkp_is_cancelling||(!p.lastZipResponse.error&&p.lastZipResponse.continue?r.options_filebackup():(setTimeout(function(){r.options_routeNextStep()},1200),p.processFinished=!0))}}))},this.watchProgress=function(){p.processFinished||p.isPaused||p.flmbkp_is_cancelling?p.progressLastRun=!0:p.progressLastRun=!1,setTimeout(function(){p.flmbkp_is_cancelling||t.ajax({url:ajaxurl,type:"GET",data:{action:"flmbkp_backup_watchprogress",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce},dataType:"json",success:function(e){if(""!==p.currentOption){for(var s="",t=0,r=0,r=e.msgs.indexOf(p.lastPrintedMessage)+1;r<e.msgs.length;r++)p.lastPrintedMessage=e.msgs[r],s+="\n"+e.msgs[r],t++;var a,n=progressLogObj.val().split("\n").length,o=progressLogObj.val();200<=n&&((a=progressLogObj.val().split("\n")).splice(0,n-(199+t)),o=a.join("\n")),progressLogObj.val(o+s),progressLogObj.scrollTop(progressLogObj[0].scrollHeight),progressBarObj[currentOption].attr("aria-valuenow",e.percent),progressBarObj[currentOption].css("width",e.percent+"%"),progressBarMsgObj[currentOption].text(e.percent+"% completed"),progressBarMsgObj[currentOption].css("width",e.percent+"%"),progressBarMsgObj[currentOption].removeClass("progress-bar-animated"),p.progressLastRun&&progressBarObj[currentOption].removeClass("active")}},complete:function(){p.progressLastRun||p.flmbkp_is_cancelling||r.watchProgress()}})},1e3)}};p.flmbkp_back_backup=r=t.flmbkp_back_backup=new r,r.initialize()}($uifm,window),flmbkp_back_settings||null),flmbkp_back_helper=(($uifm="undefined"==typeof $uifm?jQuery:$uifm).isFunction(flmbkp_back_settings)||!function(s){"use strict";var e=function(){this.initialize=function(){s(document).on("click","#dbflm_page_settings .btn.btn-primary",function(e){return e.preventDefault(),e.stopPropagation(),console.log("ja"),console.log(s("#dbflm_page_settings_form").serialize()),s.ajax({type:"POST",url:ajaxurl,dataType:"json",beforeSend:function(){},data:{action:"flmbkp_settings_saveoptions",page:"flmbkp_page_settings",flmbkp_security:flmbkp_vars.ajax_nonce,options:s("#dbflm_page_settings_form").serialize()},success:function(e){e.success&&alert("User Roles saved successfully")}}),!1})}};window.flmbkp_back_settings=e=s.flmbkp_back_settings=new e,e.initialize()}($uifm),"undefined"==typeof $uifm&&($uifm=jQuery),flmbkp_back_helper||null);$uifm.isFunction(flmbkp_back_helper)||!function(e,s){"use strict";s.flmbkp_back_helper=e.flmbkp_back_helper=new function(){this.initialize=function(){},this.length_obj=function(e){var s,t=0;for(s in e)e.hasOwnProperty(s)&&t++;return t},this.generateUniqueID=function(e){var s=Math.random();return s.toString(36),s.toString(36).substr(2,e)},this.versionCompare=function(e,s,t){var r=t&&t.lexicographical,t=t&&t.zeroExtend,a=e.split("."),n=s.split(".");function o(e){return(r?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!a.every(o)||!n.every(o))return NaN;if(t){for(;a.length<n.length;)a.push("0");for(;n.length<a.length;)n.push("0")}r||(a=a.map(Number),n=n.map(Number));for(var p=0;p<a.length;++p){if(n.length==p)return 1;if(a[p]!=n[p])return a[p]>n[p]?1:-1}return a.length!=n.length?-1:0},this.getData=function(e,s){return e[s]},this.setData=function(e,s,t){e[s]=t},this.getData2=function(e,s,t){try{return e[s][t]}catch(e){console.log("error getUiData2: "+e.message)}},this.setData2=function(e,s,t,r){e.hasOwnProperty(s)||(e[s]={}),e[s].hasOwnProperty(t)||(e[s][t]={}),e[s][t]=r},this.getData3=function(e,s,t,r){try{return e[s][t][r]}catch(e){console.log("error getUiData3: "+e.message)}},this.delData3=function(e,s,t,r){delete e[s][t][r]},this.setData3=function(e,s,t,r,a){e.hasOwnProperty(s)||(e[s]={}),e[s].hasOwnProperty(t)||(e[s][t]={}),e[s][t][r]=a},this.setData4=function(e,s,t,r,a,n){e.hasOwnProperty(s)||(e[s]={}),e[s].hasOwnProperty(t)||(e[s][t]={}),e[s][t].hasOwnProperty(r)||(e[s][t][r]={}),e[s][t][r][a]=n},this.getData4=function(e,s,t,r,a){try{return e[s][t][r][a]}catch(e){console.log("error getUiData4: "+e.message)}},this.getData5=function(e,s,t,r,a,n){try{return void 0===e[s][t]?"":e[s][t][r][a][n]}catch(e){return console.log("error getUiData5: "+e.message),""}},this.setData5=function(e,s,t,r,a,n,o){e.hasOwnProperty(s)||(e[s]={}),e[s].hasOwnProperty(t)||(e[s][t]={}),e[s][t].hasOwnProperty(r)||(e[s][t][r]={}),e[s][t][r].hasOwnProperty(a)||(e[s][t][r][a]={}),e[s][t][r][a][n]=o},this.addIndexData5=function(e,s,t,r,a,n,o){void 0!==e[s][t][r][a][n]&&(e[s][t][r][a][n][o]={})},this.getData6=function(e,s,t,r,a,n,o){try{return void 0===e[s][t][r][a][n][o]?"":e[s][t][r][a][n][o]}catch(e){return console.log("error handled - getUiData6: "+e.message),""}},this.setData6=function(e,s,t,r,a,n,o,p){e.hasOwnProperty(s)||(e[s]={}),e[s].hasOwnProperty(t)||(e[s][t]={}),e[s][t].hasOwnProperty(r)||(e[s][t][r]={}),e[s][t][r].hasOwnProperty(a)||(e[s][t][r][a]={}),e[s][t][r][a].hasOwnProperty(n)||(e[s][t][r][a][n]={}),e[s][t][r][a][n][o]=p},this.delData6=function(e,s,t,r,a,n,o){delete e[s][t][r][a][n][o]},this.redirect_tourl=function(e){s.event?(s.event.returnValue=!1,s.location=e):location.href=e}}}($uifm,window);