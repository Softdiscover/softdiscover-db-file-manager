var flmbkp_back_fm=flmbkp_back_fm||null,flmbkp_back_backup=(($uifm="undefined"==typeof $uifm?jQuery:$uifm).isFunction(flmbkp_back_fm)||!function(e,t){"use strict";var r=function(){this.initialize=function(){e(document).on("change",".uiform-editing-header select",function(e){r.header_options_submit()})},this.header_options_submit=function(){console.log("change  submit"),e.ajax({type:"POST",url:ajaxurl,data:{action:"flmbkp_header_options",page:"flmbkp_file_manager",flmbkp_security:flmbkp_vars.ajax_nonce,options:e("#flmbkp_header_opt").serialize()},success:function(e){flmbkp_back_helper.redirect_tourl(e.url)}})}};t.flmbkp_back_fm=r=e.flmbkp_back_fm=new r,r.initialize()}($uifm,window),flmbkp_back_backup||null),flmbkp_back_settings=(($uifm="undefined"==typeof $uifm?jQuery:$uifm).isFunction(flmbkp_back_backup)||!function(r,e){"use strict";var s=function(){this.initialize=function(){r(document).on("click","#flmbkp_backup_form button",function(e){return e.preventDefault(),e.stopPropagation(),r(this).prop("disabled",!0),s.options_createRec(),!1})},this.options_createRec=function(){0<r("#flmbkp_backup_form input:checked").length?(r("#flmbkp_progress_graph").show(),r.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{action:"flmbkp_backup_createrec",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,options:r("#flmbkp_backup_form").serialize()},success:function(e){for(var t in flmbkp_slug=e.slug,flmbkp_counter_qu=e.pending,url_redirect_afterbkp=e.url_redirect,flmbkp_counter_qu)r("#flmbkp_progress_"+flmbkp_counter_qu[t]).show();s.options_routeNextStep()}})):(r("#flmbkp_backup_form button").prop("disabled",!1),alert("Select one option at least"))},this.records_delreg=function(t){r.ajax({type:"POST",url:ajaxurl,data:{action:"flmbkp_backup_delete_records",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,rec_id:t},success:function(e){r(".sfdc-block1-container a[data-recid='"+t+"']").closest("tr").fadeOut("slow")}})},this.records_restore=function(e){r.ajax({type:"POST",url:ajaxurl,data:{action:"flmbkp_backup_restore_records",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce,rec_id:e},success:function(e){r("#flmbkp_Modal").modal({show:!0,backdrop:"static",keyboard:!1}),r("#flmbkp_Modal .modal-title").html(e.modal_title),r("#flmbkp_Modal .modal-body").html(e.modal_body)}})},this.options_routeNextStep=function(){if(jQuery.isEmptyObject(flmbkp_counter_qu))nextstep="",processFinished=!0,r("#flmbkp_backup_form").find("button").prop("disabled",!0),flmbkp_back_helper.redirect_tourl(url_redirect_afterbkp);else switch(processFinished=!0,progressLastRun=!1,lastPrintedMessage="",initialRun=1,selected_paths=[],lastZipResponse={},isPaused=!1,cwd="",dir_listing=[],tmp_var1=function(e){for(var t in e)return[e[t],t]}(flmbkp_counter_qu),currentOption=tmp_var1[0],delete flmbkp_counter_qu[tmp_var1[1]],String(currentOption)){case"plugins":progressBarObj[currentOption]=r("#flmbkp_plugins_progress"),progressBarMsgObj[currentOption]=r("#flmbkp_plugins_progress_msg"),s.options_filebackup();break;case"themes":progressBarObj[currentOption]=r("#flmbkp_themes_progress"),progressBarMsgObj[currentOption]=r("#flmbkp_themes_progress_msg"),s.options_filebackup();break;case"uploads":progressBarObj[currentOption]=r("#flmbkp_uploads_progress"),progressBarMsgObj[currentOption]=r("#flmbkp_uploads_progress_msg"),s.options_filebackup();break;case"others":progressBarObj[currentOption]=r("#flmbkp_others_progress"),progressBarMsgObj[currentOption]=r("#flmbkp_others_progress_msg"),s.options_filebackup();break;case"database":progressBarObj[currentOption]=r("#flmbkp_database_progress"),progressBarMsgObj[currentOption]=r("#flmbkp_database_progress_msg"),s.options_filebackup();break;default:console.log("there is no option")}},this.options_downloadFiles=function(e){r("body").append("<iframe src='"+ajaxurl+"?action=flmbkp_backup_downloadfile&page=flmbkp_page_backups&flmbkp_security="+flmbkp_vars.ajax_nonce+"&flm_file="+e+"' style='display: none;' ></iframe>")},this.options_filebackup=function(){isPaused=!1,selected_paths=[cwd],isPaused||(initialRun&&(progressLogObj.val(""),lastPrintedMessage=""),progressBarObj[currentOption].addClass("active"),r.ajax({type:"POST",url:ajaxurl,dataType:"json",beforeSend:function(){processFinished=!1,initialRun&&s.watchProgress(),initialRun=0},data:{targets:selected_paths,flush_to_disk:50,max_execution_time:20,excludes:"",is_initial_run:initialRun,use_system_calls:!1,nexstep:currentOption,flmbkp_slug:flmbkp_slug,action:"flmbkp_backup_sendoptions",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce},success:function(e){(lastZipResponse=e).continue},complete:function(){!lastZipResponse.error&&lastZipResponse.continue?s.options_filebackup():(setTimeout(function(){s.options_routeNextStep()},3e3),processFinished=!0)}}))},this.watchProgress=function(){progressLastRun=!(!processFinished&&!isPaused),setTimeout(function(){r.ajax({url:ajaxurl,type:"GET",data:{action:"flmbkp_backup_watchprogress",page:"flmbkp_page_backups",flmbkp_security:flmbkp_vars.ajax_nonce},dataType:"json",success:function(e){if(""!=currentOption){for(var t="",r=0,s=0,s=e.msgs.indexOf(lastPrintedMessage)+1;s<e.msgs.length;s++)lastPrintedMessage=e.msgs[s],t+="\n"+e.msgs[s],r++;var n,a=progressLogObj.val().split("\n").length,o=progressLogObj.val();200<=length&&((n=progressLogObj.val().split("\n")).splice(0,a-(199+r)),o=n.join("\n")),progressLogObj.val(o+t),progressLogObj.scrollTop(progressLogObj[0].scrollHeight),progressBarObj[currentOption].attr("aria-valuenow",e.percent),progressBarObj[currentOption].css("width",e.percent+"%"),progressBarMsgObj[currentOption].text(e.percent+"% completed"),progressBarMsgObj[currentOption].css("width",e.percent+"%"),progressBarMsgObj[currentOption].removeClass("progress-bar-animated"),progressLastRun&&progressBarObj[currentOption].removeClass("active")}},complete:function(){progressLastRun||s.watchProgress()}})},1e3)}};e.flmbkp_back_backup=s=r.flmbkp_back_backup=new s,s.initialize()}($uifm,window),flmbkp_back_settings||null),flmbkp_back_helper=(($uifm="undefined"==typeof $uifm?jQuery:$uifm).isFunction(flmbkp_back_settings)||!function(t){"use strict";var e=function(){this.initialize=function(){t(document).on("click","#dbflm_page_settings .btn.btn-primary",function(e){return e.preventDefault(),e.stopPropagation(),console.log("ja"),console.log(t("#dbflm_page_settings_form").serialize()),t.ajax({type:"POST",url:ajaxurl,dataType:"json",beforeSend:function(){},data:{action:"flmbkp_settings_saveoptions",page:"flmbkp_page_settings",flmbkp_security:flmbkp_vars.ajax_nonce,options:t("#dbflm_page_settings_form").serialize()},success:function(e){e.success&&alert("User Roles saved successfully")}}),!1})}};window.flmbkp_back_settings=e=t.flmbkp_back_settings=new e,e.initialize()}($uifm),"undefined"==typeof $uifm&&($uifm=jQuery),flmbkp_back_helper||null);$uifm.isFunction(flmbkp_back_helper)||!function(e,t){"use strict";t.flmbkp_back_helper=e.flmbkp_back_helper=new function(){this.initialize=function(){},this.length_obj=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},this.generateUniqueID=function(e){var t=Math.random();return t.toString(36),t.toString(36).substr(2,e)},this.versionCompare=function(e,t,r){var s=r&&r.lexicographical,r=r&&r.zeroExtend,n=e.split("."),a=t.split(".");function o(e){return(s?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!n.every(o)||!a.every(o))return NaN;if(r){for(;n.length<a.length;)n.push("0");for(;a.length<n.length;)a.push("0")}s||(n=n.map(Number),a=a.map(Number));for(var i=0;i<n.length;++i){if(a.length==i)return 1;if(n[i]!=a[i])return n[i]>a[i]?1:-1}return n.length!=a.length?-1:0},this.getData=function(e,t){return e[t]},this.setData=function(e,t,r){e[t]=r},this.getData2=function(e,t,r){try{return e[t][r]}catch(e){console.log("error getUiData2: "+e.message)}},this.setData2=function(e,t,r,s){e.hasOwnProperty(t)||(e[t]={}),e[t].hasOwnProperty(r)||(e[t][r]={}),e[t][r]=s},this.getData3=function(e,t,r,s){try{return e[t][r][s]}catch(e){console.log("error getUiData3: "+e.message)}},this.delData3=function(e,t,r,s){delete e[t][r][s]},this.setData3=function(e,t,r,s,n){e.hasOwnProperty(t)||(e[t]={}),e[t].hasOwnProperty(r)||(e[t][r]={}),e[t][r][s]=n},this.setData4=function(e,t,r,s,n,a){e.hasOwnProperty(t)||(e[t]={}),e[t].hasOwnProperty(r)||(e[t][r]={}),e[t][r].hasOwnProperty(s)||(e[t][r][s]={}),e[t][r][s][n]=a},this.getData4=function(e,t,r,s,n){try{return e[t][r][s][n]}catch(e){console.log("error getUiData4: "+e.message)}},this.getData5=function(e,t,r,s,n,a){try{return void 0===e[t][r]?"":e[t][r][s][n][a]}catch(e){return console.log("error getUiData5: "+e.message),""}},this.setData5=function(e,t,r,s,n,a,o){e.hasOwnProperty(t)||(e[t]={}),e[t].hasOwnProperty(r)||(e[t][r]={}),e[t][r].hasOwnProperty(s)||(e[t][r][s]={}),e[t][r][s].hasOwnProperty(n)||(e[t][r][s][n]={}),e[t][r][s][n][a]=o},this.addIndexData5=function(e,t,r,s,n,a,o){void 0!==e[t][r][s][n][a]&&(e[t][r][s][n][a][o]={})},this.getData6=function(e,t,r,s,n,a,o){try{return void 0===e[t][r][s][n][a][o]?"":e[t][r][s][n][a][o]}catch(e){return console.log("error handled - getUiData6: "+e.message),""}},this.setData6=function(e,t,r,s,n,a,o,i){e.hasOwnProperty(t)||(e[t]={}),e[t].hasOwnProperty(r)||(e[t][r]={}),e[t][r].hasOwnProperty(s)||(e[t][r][s]={}),e[t][r][s].hasOwnProperty(n)||(e[t][r][s][n]={}),e[t][r][s][n].hasOwnProperty(a)||(e[t][r][s][n][a]={}),e[t][r][s][n][a][o]=i},this.delData6=function(e,t,r,s,n,a,o){delete e[t][r][s][n][a][o]},this.redirect_tourl=function(e){t.event?(t.event.returnValue=!1,t.location=e):location.href=e}}}($uifm,window);